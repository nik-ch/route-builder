(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{27:function(e,t,n){e.exports=n(69)},65:function(e,t,n){},69:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(15),i=n(8),s=n.n(i),c=n(10),u=n(2),l=n(3),d=n(6),p=n(5),h=n(7),g=n(11),m=n(26),f=n.n(m),v=function(){function e(){Object(u.a)(this,e)}return Object(l.a)(e,[{key:"createMap",value:function(e,t,n){if(this.yandexMap)throw new Error("yandex map instance already exists");this.yandexMap=new window.ymaps.Map(e,{center:t,zoom:n})}},{key:"createPlacemark",value:function(e,t){var n=new window.ymaps.Placemark(this.yandexMap.getCenter(),{balloonContentBody:e},{draggable:!0});return t&&n.events.add("dragend",t),this.yandexMap.geoObjects.add(n),n}},{key:"updatePolyline",value:function(e){null!=this.polyline?this.polyline.geometry.setCoordinates(e.map(function(e){return e.geometry.getCoordinates()})):e.length>1&&(this.polyline=new window.ymaps.Polyline(e.map(function(e){return e.geometry.getCoordinates()})),this.yandexMap.geoObjects.add(this.polyline))}},{key:"getPlacemarkGeographicAddress",value:function(){var e=Object(c.a)(s.a.mark(function e(t){var n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.geometry.getCoordinates(),e.next=3,f.a.get("https://geocode-maps.yandex.ru/1.x/",{params:{apikey:"9f0d1ea1-8932-41ba-a54e-612efe8507b1",geocode:"".concat(n[1],",").concat(n[0]),format:"json",results:1,lang:"en_RU"}});case 3:return a=e.sent,e.abrupt("return",{name:a.data.response.GeoObjectCollection.featureMember[0].GeoObject.name,description:a.data.response.GeoObjectCollection.featureMember[0].GeoObject.description});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"togglePlacemarkFocus",value:function(e,t){t?(e.options.set("preset","islands#orangeIcon"),this.yandexMap.setCenter(e.geometry.getCoordinates())):e.options.set("preset","islands#blueIcon")}},{key:"removePlacemark",value:function(e){this.yandexMap.geoObjects.remove(e)}}]),e}(),_=function(e){var t=e.geoDataShown&&e.geoData,n="route-point list__route-point";return e.dragStarted&&(n+=" list__route-point_drag-started"),e.dragEntered&&(n+=" list__route-point_drag-entered"),r.a.createElement("div",{className:n,draggable:"true",onDragStart:e.onDragStartHandler,onDragEnd:e.onDragEndHandler,onDragEnter:e.onDragEnterHandler,onDragLeave:e.onDragLeaveHandler,onDragOver:e.onDragOverHandler,onDrop:e.onDropHandler},r.a.createElement("div",{className:"route-point__main-info"},r.a.createElement("span",{className:"route-point__name"},e.name),r.a.createElement("span",{className:"route-point__remove-cross",title:"Remove route point",onClick:function(t){t.stopPropagation(),e.onRemoveHandler()}},"\u2716")),r.a.createElement("div",{className:"route-point__address-link",onClick:e.onClickHandler},t?"Hide address":"View address"),r.a.createElement("div",{className:"route-point__geo-data-info".concat(t?" route-point__geo-data-info_shown":"")},t&&"".concat(e.geoData.name,". ").concat(e.geoData.description,".")))},y=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={startIndex:null,enterIndex:null},n.onDragStart=function(e){n.setState({startIndex:e})},n.onDragEnd=function(){n.setState({startIndex:null})},n.onDragEnter=function(e){n.setState({enterIndex:e})},n.onDragLeave=function(){n.setState({enterIndex:null})},n.onDrop=function(e){n.state.startIndex!==e&&n.props.onPointDropHandler(n.state.startIndex,e),n.setState({enterIndex:null})},n.onInputKeyUp=function(e){13===e.keyCode&&e.target.value&&(n.props.onNameSetHandler(e.target.value),e.target.value=null)},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"onDragOver",value:function(e){return e.preventDefault&&e.preventDefault(),!1}},{key:"render",value:function(){var e=this,t=(this.props.routePoints||[]).map(function(t,n){return r.a.createElement(_,{key:t.id,name:t.name,geoDataShown:t.geoDataShown,geoData:t.geoData,dragStarted:e.state.startIndex===n,dragEntered:e.state.enterIndex===n,onDragStartHandler:function(){return e.onDragStart(n)},onDragEnterHandler:function(){return e.onDragEnter(n)},onDragEndHandler:e.onDragEnd,onDragLeaveHandler:e.onDragLeave,onDragOverHandler:e.onDragOver,onDropHandler:function(){return e.onDrop(n)},onClickHandler:function(){return e.props.onClickHandler(n)},onRemoveHandler:function(){return e.props.onRemovePointHandler(n)}})});return r.a.createElement("div",{className:"route-points-list"},r.a.createElement("div",{className:"route-points-list__input-wrapper"},r.a.createElement("input",{type:"text",placeholder:"New route point",className:"route-points-list__input",onKeyUp:this.onInputKeyUp})),r.a.createElement("div",{className:"list"},t))}}]),t}(r.a.Component),E=function(){function e(){Object(u.a)(this,e)}return Object(l.a)(e,null,[{key:"createHandlers",value:function(){e._instance||(e._instance=new(function(){function t(){Object(u.a)(this,t),this._lastCLick=0,"ontouchstart"in document&&(document.addEventListener("touchstart",this.touchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.touchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.touchEnd.bind(this),{passive:!1}),document.addEventListener("touchcancel",this.touchEnd.bind(this),{passive:!1}))}return Object(l.a)(t,[{key:"touchStart",value:function(t){var n=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<e._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target))return t.preventDefault(),void this._reset();this._reset();var a=this._closestDraggable(t.target);a&&(this._dispatchEvent(t,"mousemove",t.target)||this._dispatchEvent(t,"mousedown",t.target)||(this._dragSource=a,this._ptDown=this._getPoint(t),this._lastTouch=t,t.preventDefault(),setTimeout(function(){n._dragSource===a&&null===n._img&&n._dispatchEvent(t,"contextmenu",a)&&n._reset()},e._CTXMENU)))}}},{key:"touchMove",value:function(t){if(this._shouldHandle(t)){var n=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",n))return this._lastTouch=t,void t.preventDefault();if(this._dragSource&&!this._img)this._getDelta(t)>e._THRESHOLD&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",n));this._img&&(this._lastTouch=t,t.preventDefault(),n!==this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",n),this._lastTarget=n),this._moveImage(t),this._dispatchEvent(t,"dragover",n))}}},{key:"touchEnd",value:function(e){this._shouldHandle(e)&&(this._dispatchEvent(this._lastTouch,"mouseup",e.target)?e.preventDefault():(this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",e.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(e.type.indexOf("cancel")<0&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())))}},{key:"_shouldHandle",value:function(e){return e&&!e.defaultPrevented&&e.touches&&e.touches.length<2}},{key:"_closestDraggable",value:function(e){for(;e;e=e.parentElement)if(e.hasAttribute("draggable"))return e;return null}},{key:"_getTarget",value:function(e){for(var t=this._getPoint(e),n=document.elementFromPoint(t.x,t.y);n&&"none"===getComputedStyle(n).pointerEvents;)n=n.parentElement;return n}},{key:"_createImage",value:function(t){this._img&&this._destroyImage();var n=this._dragSource;this._img=n.cloneNode(!0),this._copyStyle(n,this._img);var a=n.getBoundingClientRect(),r=this._getPoint(t);this._imgOffset={x:r.x-a.left,y:r.y-a.top},this._img.style.opacity=e._OPACITY.toString(),this._moveImage(t),document.body.appendChild(this._img)}},{key:"_moveImage",value:function(e){var t=this;requestAnimationFrame(function(){var n=t._getPoint(e,!0),a=t._img.style;a.position="absolute",a.pointerEvents="none",a.zIndex="999999",a.left=Math.round(n.x-t._imgOffset.x)+"px",a.top=Math.round(n.y-t._imgOffset.y)+"px"})}},{key:"_copyStyle",value:function(t,n){e._rmvAttrs.forEach(function(e){n.removeAttribute(e)});for(var a=getComputedStyle(t),r=0;r<a.length;r++){var o=a[r];n.style[o]=a[o]}n.style.pointerEvents="none";for(var i=0;i<t.children.length;i++)this._copyStyle(t.children[i],n.children[i])}},{key:"_destroyImage",value:function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null}},{key:"_getDelta",value:function(e){var t=this._getPoint(e);return Math.abs(t.x-this._ptDown.x)+Math.abs(t.y-this._ptDown.y)}},{key:"_getPoint",value:function(e,t){return e&&e.touches&&(e=e.touches[0]),{x:t?e.pageX:e.clientX,y:t?e.pageY:e.clientY}}},{key:"_reset",value:function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._dataTransfer=e._createDataTransfer()}},{key:"_dispatchEvent",value:function(t,n,a){if(!t||!a)return!1;var r=document.createEvent("Event");r.initEvent(n,!0,!0);var o=t.touches?t.touches[0]:t;return r.button=0,r.buttons=1,this._copyProps(r,t,e._kbdProps),this._copyProps(r,o,e._ptProps),r.dataTransfer=this._dataTransfer,a.dispatchEvent(r),r.defaultPrevented}},{key:"_copyProps",value:function(e,t,n){n.forEach(function(n){e[n]=t[n]})}}]),t}()))}},{key:"_createDataTransfer",value:function(){return new(function(){function e(){Object(u.a)(this,e),this._dropEffect="move",this._effectAllowed="move",this._data={},this._dropEffectPossibleValues=["copy","move","link","none"],this._effectAllowedPossibleValues=["none","copy","copyLink","copyMove","link","linkMove","move","all","uninitialized"]}return Object(l.a)(e,[{key:"getData",value:function(e){return this._data[e]||""}},{key:"setData",value:function(e,t){this._data[e]=t}},{key:"clearData",value:function(e){null!=e?delete this._data[e]:this._data=null}},{key:"dropEffect",get:function(){return this._dropEffect},set:function(e){if(!this._dropEffectPossibleValues.includes(e))throw new Error("dropEffect value should be one of ".concat(this._dropEffectPossibleValues));this._dropEffect=e}},{key:"effectAllowed",get:function(){return this._effectAllowed},set:function(e){if(!this._effectAllowedPossibleValues.includes(e))throw new Error("dropEffect value should be one of ".concat(this._effectAllowedPossibleValues));this._effectAllowed=e}}]),e}())}},{key:"_DBLCLICK",get:function(){return 500}},{key:"_THRESHOLD",get:function(){return 5}},{key:"_OPACITY",get:function(){return.5}},{key:"_CTXMENU",get:function(){return 900}},{key:"_rmvAttrs",get:function(){return["id","class","style","draggable"]}},{key:"_kbdProps",get:function(){return["altKey","ctrlKey","metaKey","shiftKey"]}},{key:"_ptProps",get:function(){return["pageX","pageY","clientX","clientY","screenX","screenY"]}}]),e}(),k=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).addRoutePoint=function(e){try{var t=n.state.lastUsedId+1,a=n.ymapApiWrapper.createPlacemark(e,function(){return n.placemarkDragEndHandler(t)}),r={name:e,id:t,placemark:a},o=n.state.routePoints.slice().concat(r);n.ymapApiWrapper.updatePolyline(o.map(function(e){return e.placemark})),n.setState({routePoints:o,lastUsedId:t})}catch(i){n.showErrorToast("Error occurred during adding placemark.")}},n.placemarkDragEndHandler=function(e){try{var t=n.state.routePoints,a=t.find(function(t){return t.id===e});a.geoData=null,a.geoDataShown=!1,n.ymapApiWrapper.updatePolyline(n.state.routePoints.map(function(e){return e.placemark})),n.setState({routePoints:t})}catch(r){n.showErrorToast("Error occurred during dragging placemark.")}},n.removeRoutePoint=function(e){try{var t=n.state.routePoints,a=t[e].placemark,r=t.slice(0,e).concat(t.slice(e+1));n.ymapApiWrapper.removePlacemark(a),n.ymapApiWrapper.updatePolyline(r.map(function(e){return e.placemark})),n.setState({routePoints:r})}catch(o){n.showErrorToast("Error occurred during removing placemark.")}},n.swapRoutePoints=function(e,t){try{var a=Math.min(e,t),r=Math.max(e,t),o=n.state.routePoints,i=o[a],s=o[r],c=o.slice(0,a).concat(s).concat(o.slice(a+1,r)).concat(i).concat(o.slice(r+1));n.ymapApiWrapper.updatePolyline(c.map(function(e){return e.placemark})),n.setState({routePoints:c})}catch(u){n.showErrorToast("Error occurred during swapping placemarks.")}},n.getGeographicAddress=function(){var e=Object(c.a)(s.a.mark(function e(t){var a,r,o,i,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=n.state.routePoints,r=a[t],o=r.placemark,i=function(){var e=!r.geoDataShown;n.ymapApiWrapper.togglePlacemarkFocus(o,e),r.geoDataShown=e,n.setState({routePoints:a})},r.geoDataShown||r.geoData){e.next=15;break}return c=!0,n.ymapApiWrapper.togglePlacemarkFocus(o,c),e.next=10,n.ymapApiWrapper.getPlacemarkGeographicAddress(o);case 10:r.geoData=e.sent,r.geoDataShown=c,n.setState({routePoints:a}),e.next=16;break;case 15:i();case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),n.showErrorToast("Error occurred during loading geographic address.");case 21:case"end":return e.stop()}},e,this,[[0,18]])}));return function(t){return e.apply(this,arguments)}}(),n.state={routePoints:[],lastUsedId:0},n.ymapId="ymap",n.ymapApiWrapper=new v,E.createHandlers(),n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("load",function(){e.ymapApiWrapper.createMap(e.ymapId,[55.75136970917547,37.61889271429428],15)})}},{key:"showErrorToast",value:function(e){Object(g.toast)(e,{type:g.toast.TYPE.ERROR,bodyClassName:"notification-container__notification-body"})}},{key:"render",value:function(){return r.a.createElement("div",{className:"wrapper"},r.a.createElement("div",{className:"wrapper__route-points-list"},r.a.createElement(y,{routePoints:this.state.routePoints,onPointDropHandler:this.swapRoutePoints,onRemovePointHandler:this.removeRoutePoint,onNameSetHandler:this.addRoutePoint,onClickHandler:this.getGeographicAddress})),r.a.createElement("div",{className:"wrapper__yandex-map"},r.a.createElement("div",{id:this.ymapId,className:"yandex-map"})),r.a.createElement(g.ToastContainer,{hideProgressBar:!0,className:"notification-container"}))}}]),t}(r.a.Component),D=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={hasError:!1},n}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.state.hasError?r.a.createElement("p",null,"Something went wrong. Please, refresh the page and try again. If this message appears again, feel free to contact us via email."):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(r.a.Component);n(65),n(67);Object(o.render)(r.a.createElement(D,null,r.a.createElement(k,null)),document.getElementById("root"))}},[[27,2,1]]]);
//# sourceMappingURL=main.fd5a20cb.chunk.js.map